DROP TABLE IF EXISTS jouabilite;
DROP TABLE IF EXISTS personnage;
DROP TABLE IF EXISTS map;


CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE map (
    map_id integer GENERATED BY DEFAULT AS IDENTITY,
    map_ville character varying(50) NULL,
    map_pays character varying(50) NULL,
    CONSTRAINT pk_flm PRIMARY KEY (map_id)
);

CREATE TABLE personnage (
    perso_id integer GENERATED BY DEFAULT AS IDENTITY,
    perso_nom character varying(50) NULL,
    perso_prenom character varying(50) NULL,
    perso_pays character varying(50) NULL DEFAULT 'On sait pas',
    perso_datecreation date NOT NULL DEFAULT (now()),
    perso_notediff integer NOT NULL,
    CONSTRAINT pk_utl PRIMARY KEY (perso_id)
);

CREATE TABLE jouabilite (
    perso_id integer NOT NULL,
    flm_id integer NOT NULL,
    not_note integer NOT NULL,
    CONSTRAINT pk_not PRIMARY KEY (perso_id, flm_id),
    CONSTRAINT ck_not_note CHECK (not_note between 0 and 5),
    CONSTRAINT fk_jouable_map FOREIGN KEY (flm_id) REFERENCES map (map_id) ON DELETE RESTRICT,
    CONSTRAINT fk_jouable_perso FOREIGN KEY (perso_id) REFERENCES personnage (perso_id) ON DELETE RESTRICT
);

CREATE INDEX "IX_jouabilite_flm_id" ON jouabilite (flm_id);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20240220175704_CreationBDMapRatings', '6.0.13');

COMMIT;








INSERT INTO map(map_ville, map_pays)
VALUES ('Paris', 'france');
INSERT INTO map(map_ville, map_pays)
VALUES ('Paraiso', 'italie');
INSERT INTO map(map_ville, map_pays)
VALUES ('Halland', 'je ne sais pas' );

INSERT INTO personnage(perso_nom, perso_prenom, perso_pays, perso_datecreation, perso_notediff)
VALUES ('Tony', 'Stark', 'États-Unis', '1970-05-29', 5);

INSERT INTO personnage(perso_nom, perso_prenom, perso_pays, perso_datecreation, perso_notediff)
VALUES ('Natasha', 'Romanoff', 'Russie', '1984-11-22', 4);

INSERT INTO personnage(perso_nom, perso_prenom, perso_pays, perso_datecreation, perso_notediff)
VALUES ('Bruce', 'Banner', 'États-Unis', '1969-12-18', 3);

INSERT INTO personnage(perso_nom, perso_prenom, perso_pays, perso_datecreation, perso_notediff)
VALUES ('Clint', 'Barton', 'États-Unis', '1971-01-07', 3);

-- Ajoutez d'autres INSERT INTO pour les autres personnages

INSERT INTO map(map_ville, map_pays)
VALUES ('New York', 'États-Unis');

INSERT INTO map(map_ville, map_pays)
VALUES ('Moscou', 'Russie');

-- Ajoutez d'autres INSERT INTO pour les autres maps

INSERT INTO jouabilite(perso_id, flm_id, not_note)
VALUES (11, 15, 5);

INSERT INTO jouabilite(perso_id, flm_id, not_note)
VALUES (9, 16, 4);

